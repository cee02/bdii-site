è preciso alterar a tabela armazem e retirar a data de entrada e saida
Alterar a tabela componeneteArmazem e adicionar data de entra e saida

CREATE VIEW componente_saida_stock_recente AS
SELECT
    C.nome AS nome_componente,
    C.quantidade AS quantidade_componente,
    A.nome AS nome_armazem,
    CA.data_saida
FROM
    ComponenteArmazem CA
JOIN Componentes C ON CA.componenteID = C.ID
JOIN Armazem A ON CA.id_armazem = A.ID_armazem
WHERE
    CA.data_saida IS NOT NULL
ORDER BY
    CA.data_saida DESC
LIMIT 10;

CREATE VIEW componente_entrada_stock_recente AS
SELECT
    C.nome AS nome_componente,
    C.quantidade AS quantidade_componente,
    A.nome AS nome_armazem,
    CA.data_entrada
FROM
    ComponenteArmazem CA
JOIN Componentes C ON CA.componenteID = C.ID
JOIN Armazem A ON CA.id_armazem = A.ID_armazem
WHERE
    CA.data_saida IS NOT NULL
ORDER BY
    CA.data_saida DESC
LIMIT 10;


//esta view não estava bem era só para conseguir abrir a pagina dashboard
//usar esta para substituir a view anterior
CREATE VIEW equipamento_entrada_stock_recente AS
SELECT
    E.tipo AS tipo_equipamento,
    E.descricao AS descricao_equipamento,
    A.nome AS nome_armazem,
    EA.data_entrada
FROM
    EquipamentoArmazem EA
JOIN equipamento E ON EA.equipamentoID = E.id_equipamento
JOIN Armazem A ON EA.id_armazem = A.ID_armazem
WHERE
    EA.data_entrada IS NOT NULL
ORDER BY
    EA.data_entrada DESC
LIMIT 10;



INSERT INTO ComponenteArmazem (componenteID, id_armazem, data_entrada, data_saida)
VALUES
    (6, 1, '2024-01-01', '2024-01-05'), 
    (7, 1, '2024-01-02', '2024-01-06'), 
    (8, 1, '2024-01-04', '2024-01-08'), 
    (9, 1, '2024-01-05', '2024-01-09'), 
    (10, 1, '2024-01-05', '2024-01-09'), 
    (11, 1, '2024-01-06', '2024-01-10'),
	(12, 1, '2024-01-04', '2024-01-08'), 
    (13, 1, '2024-01-05', '2024-01-09'), 
    (14, 1, '2024-01-05', '2024-01-09'), 
    (15, 1, '2024-01-06', '2024-01-10'),
	(16, 1, '2024-01-04', '2024-01-08'), 
    (17, 1, '2024-01-05', '2024-01-09'), 
    (18, 1, '2024-01-04', '2024-01-08'), 
    (19, 1, '2024-01-05', '2024-01-09'), 
    (20, 1, '2024-01-06', '2024-01-10');

Criar esta tabela no PGAdmin

CREATE TABLE EquipamentoArmazem (
    equipamentoID INT,
    id_armazem INT,
    data_entrada DATE,
    data_saida DATE,
    FOREIGN KEY (equipamentoID) REFERENCES equipamento(id_equipamento),
    FOREIGN KEY (id_armazem) REFERENCES Armazem(ID_armazem)
);


INSERT INTO EquipamentoArmazem (equipamentoID, id_armazem, data_entrada, data_saida)
VALUES
    (1, 2, '2024-01-01', '2024-01-05'), 
    (2, 2, '2024-01-02', '2024-01-06'), 
    (3, 2, '2024-01-04', '2024-01-08'), 
    (4, 2, '2024-01-05', '2024-01-09'), 
    (5, 2, '2024-01-05', '2024-01-09');


Insert INTO tipooperacao (id, descricao)
Values
(1, 'Montagem de board'),
(2, 'Montagem de ram'),
(3, 'Montagem de GPU'),
(4, 'Montagem Completa'),
(5, 'Instalação de Periféricos'),
(6, 'Embalagem');


Insert Into maoobra (id, tipo, custo)
Values
(1, 'Operador de 1a', 40.50),
(2, 'Operador de 2a',  35.50),
(3, 'Embalador', 25.50),
(4, 'Técnico de Montagem', 59.50),
(5, 'Técnico de Manutenção', 36.50);

CREATE VIEW vw_tipo_operacao AS
SELECT * FROM tipooperacao;

CREATE VIEW vw_mao_obra AS
SELECT * FROM maoobra;

Corram isto no PGADMIN
    GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO aluno3_a
    REVOKE ALL PRIVILEGES ON ALL TABLES IN SCHEMA public FROM aluno3_c;
    GRANT ALL PRIVILEGES ON TABLE public.equipamento TO aluno3_c;   

//Tem de criar esta view se não o dashboard nao funciona
CREATE VIEW equipamento_saida_stock_recente AS
SELECT
    E.tipo AS tipo_equipamento,
    E.descricao AS descricao_equipamento,
    A.nome AS nome_armazem,
    EA.data_saida
FROM
    EquipamentoArmazem EA
JOIN equipamento E ON EA.equipamentoID = E.id_equipamento
JOIN Armazem A ON EA.id_armazem = A.ID_armazem
WHERE
    EA.data_saida IS NOT NULL
ORDER BY
    EA.data_saida DESC
LIMIT 10;


//Modificações DIA 28
//Usar esta table para substituir a que tem no pgadmin (ComponentesFichaProducao)
CREATE TABLE ComponentesFichaProducao (
    Id SERIAL PRIMARY KEY,
    idcomponente INT,
    quantidadeComponente INT,
    id_tipooperacao INT,
    id_maodeobra INT,
    datahorainicio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    datahorafim TIMESTAMP DEFAULT (CURRENT_TIMESTAMP + INTERVAL '15 minutes'),
    FOREIGN KEY (id_tipooperacao) REFERENCES tipooperacao(ID),
    FOREIGN KEY (id_maodeobra) REFERENCES maoobra(ID),
    FOREIGN KEY (idcomponente) REFERENCES componentes(ID),
  	UNIQUE (id, idcomponente)
);

//substituir esta função para o ecrâ Produção Equipamentos funcionar
CREATE OR REPLACE FUNCTION insert_componentes_ficha_producao(
    p_idcomponentes INT[],
    p_quantidadeComponente INT,
    p_id_tipooperacao INT,
    p_id_maodeobra INT
)
RETURNS VOID AS
$$
DECLARE
    idcomponente_element INT;
BEGIN
    -- Get the array length
    FOR i IN 1..array_length(p_idcomponentes, 1)
    LOOP
        -- Retrieve the idcomponente at index i
        idcomponente_element := p_idcomponentes[i];

        -- Insert into the table
       INSERT INTO ComponentesFichaProducao (id, idcomponente, quantidadeComponente, id_tipooperacao, id_maodeobra) 
        VALUES (NEXTVAL('componentesfichaproducao_id_seq'), idcomponente_element, p_quantidadeComponente, p_id_tipooperacao, p_id_maodeobra);
    END LOOP;
EXCEPTION
    WHEN others THEN
        -- Raise an exception with the error message
        RAISE EXCEPTION 'Error in insert_componentes_ficha_producao: %', SQLERRM;
END;
$$
LANGUAGE plpgsql;

GRANT USAGE, SELECT ON SEQUENCE componentesfichaproducao_id_seq TO aluno3_a;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO aluno3_a;